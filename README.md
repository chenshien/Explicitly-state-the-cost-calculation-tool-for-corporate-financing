# 企业融资成本计算工具

此工具用于计算企业综合融资成本，基于《企业贷款综合融资成本年化率的计算规则及示例》实现。

## 版本更新

### V1.2 (最新版本)
- 采用内部收益率法（IRR）计算费用年化率
- 支持银行承担费用的标记和处理
- 符合人民银行最新的计算规则要求
- 提高了计算精度和准确性

## 功能特点

- 支持多种还款方式：等额本金、等额本息、一次性还本
- 支持多种付息频率：日、月、季、半年、年
- 可添加多种费用项，支持不同支付频率
- 支持标记"银行承担"的费用（不计入融资成本）
- 自动计算企业综合融资成本和各项费用的年化利率
- 数据记录的保存、编辑和导出功能
- 贷款到期日根据贷款期限自动计算

## 安装依赖

```bash
pip install -r requirements.txt
```

## 运行程序

```bash
python main.py
```

## 使用说明

### 1. 输入基本贷款信息
- 企业名称
- 贷款本金(万元)
- 还款方式
- 贷款期限(月)
- 付息频率
- 贷款起始日
- 首次还款日
- 贷款年化率(%)

### 2. 输入附加信息（可选）
- 获取贷款渠道
- 客户类型
- 企业性质
- 担保方式
- 贷款方式
- 申请方式
- 是否财政贴息

### 3. 添加费用项
- 输入费用名称
- 输入费用金额(元)
- 选择费用支付频率
- 勾选"银行承担"（如适用）
- 点击"添加费用"按钮

### 4. 计算融资成本
- 点击"计算融资成本"按钮
- 查看计算结果和费用明细
- 银行承担的费用会标记为"[银行承担]"，其年化率为0

### 5. 管理记录
- 点击"保存记录"存储当前计算结果
- 点击记录表格中的记录可加载详情并编辑
- 点击"删除选中记录"可删除记录
- 点击"导出记录"可将所有记录导出到Excel文件

## 计算方法

本工具基于《企业贷款综合融资成本年化率的计算规则及示例》实现，采用内部收益率法（IRR）计算各项费用的年化率。

### 核心计算原理

1. **综合融资成本** = 贷款年化利率 + 各项费用年化率之和

2. **费用年化率计算**：使用内部收益率法，通过求解以下方程得到单位周期费率R：
   ```
   A = Σ Pjt / [(1+R)^st × (1+R×ft)]
   ```
   其中：
   - A：贷款本金
   - Pjt：第t次支付本金和第j项费用之和
   - st：起始日到第t次付款日间隔的完整单位周期数
   - ft：间隔的单位周期小数部分
   - 年化率 = n × R（n为年内还款频率）

3. **费用分类**：
   - **期初一次性付费**：如评估费、登记费、担保费等
   - **周期性付费**：如按月/季/年支付的监管费、保险费等

4. **银行承担费用**：标记为银行承担的费用不计入企业融资成本

## 技术实现

- 使用Python的tkinter库构建用户界面
- 使用scipy库进行内部收益率计算
- 使用numpy进行数值计算
- 使用pandas处理数据和导出Excel
- 使用SQLite数据库存储记录

## 注意事项

- 贷款本金单位为万元，费用金额单位为元
- 日期格式为YYYY-MM-DD
- 计算结果保留4位小数
- 导出的Excel文件包含完整的计算明细 